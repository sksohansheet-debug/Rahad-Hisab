<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buy & Sell - Hisab</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡ßü‡¶æ CSS - ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ */
  :root{
    --bg:#f5f7fb;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
    --line:#e5e7eb;

    --brand:#2563eb;
    --brand2:#60a5fa;

    --good:#16a34a;
    --bad:#ef4444;
    --warn:#f59e0b;

    --shadow: 0 10px 30px rgba(15,23,42,.08);
    --shadow2: 0 2px 10px rgba(15,23,42,.08);

    --r12:12px;
    --r16:16px;
    --r18:18px;

    --topbar-h: 106px;
    --sb-w: 295px;

    --del-head-row1: 40px;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(1200px 600px at 10% 0%, rgba(37,99,235,.10), transparent 55%),
      radial-gradient(1000px 600px at 90% 10%, rgba(16,185,129,.06), transparent 55%),
      var(--bg);
    padding-top: var(--topbar-h);
    color: var(--text);
  }

  .page-loader{
    position: fixed;
    inset: 0;
    z-index: 200;
    background: rgba(255,255,255,.72);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    transition: .22s ease;
  }
  .page-loader.hide{ opacity:0; pointer-events:none; }
  .loader-card{
    width: min(420px, 92vw);
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(229,231,235,.9);
    border-radius: 18px;
    box-shadow: 0 30px 120px rgba(15,23,42,.18);
    padding: 18px 16px;
    text-align: center;
  }
  .loader-title{ font-weight: 1000; font-size: 15px; color:#0f172a; margin: 10px 0 4px 0; }
  .loader-sub{ font-weight: 900; font-size: 12px; color: var(--muted); margin: 0; }
  .spinner{
    width: 54px; height: 54px; border-radius: 999px;
    border: 6px solid rgba(37,99,235,.18);
    border-top-color: rgba(37,99,235,1);
    margin: 4px auto 10px auto;
    animation: spin .9s linear infinite;
  }
  @keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }

  .navbar{
    background: rgba(255,255,255,.86);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(229,231,235,.9);
    box-shadow: 0 8px 30px rgba(15,23,42,.06);
    padding: 10px 14px;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 10;
  }
  .nav-top{
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom: 10px; gap: 10px;
  }
  .menu-icon{
    width:42px; height:42px;
    display:grid; place-items:center;
    border-radius: 14px;
    background: linear-gradient(180deg, rgba(37,99,235,.12), rgba(37,99,235,.06));
    color: var(--brand);
    font-size: 20px;
    cursor:pointer;
    box-shadow: var(--shadow2);
    user-select:none;
  }
  .navbar h1{
    font-size: 18px; margin:0; font-weight: 900;
    flex-grow:1; text-align:center; letter-spacing: .2px; color:#0f172a;
  }
  .nav-buttons{ display:flex; gap:10px; justify-content:center; }
  .btn{
    padding: 10px 14px;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 900;
    color: white;
    display:flex;
    align-items:center;
    gap: 8px;
    box-shadow: var(--shadow2);
    transition: .15s;
    white-space: nowrap;
  }
  .btn:active{ transform: scale(.99); }
  .btn-person{ background: linear-gradient(135deg, rgba(37,99,235,1), rgba(96,165,250,1)); }
  .btn-delivery{ background: linear-gradient(135deg, rgba(22,163,74,1), rgba(34,197,94,1)); }

  .sidebar-overlay{
    position:fixed; inset:0;
    background: rgba(0,0,0,.35);
    z-index: 80;
    opacity:0; pointer-events:none;
    transition:.2s;
  }
  .sidebar-overlay.show{ opacity:1; pointer-events:auto; }

  .sidebar{
    position: fixed; top: 0; left: 0;
    width: var(--sb-w); height: 100%;
    transform: translateX(-110%);
    transition: .28s ease;
    z-index: 90;
    background: linear-gradient(180deg, #0b1224 0%, #0f172a 45%, #0b1224 100%);
    box-shadow: 0 30px 80px rgba(0,0,0,.28);
    padding: 14px 14px 18px 14px;
    overflow: auto;
  }
  .sidebar.open{ transform: translateX(0); }

  .sb-head{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding: 8px 4px 12px 4px; }
  .sb-title{ color:#fff; font-weight:1000; font-size:20px; line-height:1.1; margin:2px 0 0 0; }
  .sb-sub{ color:rgba(255,255,255,.65); font-weight:800; font-size:12px; margin-top:4px; }
  .sb-close{
    width:44px; height:44px;
    border:none; border-radius: 16px;
    cursor:pointer;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.12);
    color:#fff;
    display:grid; place-items:center;
    font-size:18px;
    box-shadow: 0 10px 25px rgba(0,0,0,.25);
  }
  .sb-close:active{ transform: scale(.98); }
  .sb-divider{ height:1px; background: rgba(255,255,255,.08); margin: 10px 0 14px 0; }
  .sb-links{ display:flex; flex-direction:column; gap:12px; }
  .sidebar a{
    display:flex; align-items:center; gap:12px;
    padding: 14px 14px;
    border-radius: 16px;
    color: rgba(255,255,255,.92);
    text-decoration:none;
    font-weight: 1000;
    font-size: 15px;
    background: rgba(255,255,255,.07);
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    transition:.18s;
    margin:0;
  }
  .sidebar a:hover{
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.16);
    transform: translateY(-1px);
  }
  .sb-ic{
    width:34px; height:34px;
    border-radius: 12px;
    display:grid; place-items:center;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.10);
    font-size: 16px;
    flex: 0 0 auto;
  }

  .main-container{
    width: 100%;
    max-width: none;
    margin: 0;
    padding: 12px 18px;
  }
  @media (min-width:1200px){
    .main-container{ padding: 14px 22px; }
  }

  .filter-wrapper{
    background: rgba(255,255,255,.88);
    border: 1px solid rgba(229,231,235,.9);
    box-shadow: var(--shadow);
    padding: 14px;
    border-radius: var(--r18);
    margin-bottom: 14px;
    width: 100%;
  }
  .filter-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 14px;
    align-items: end;
  }

  label{ font-size: 12px; font-weight: 900; color: var(--muted); display:block; margin-bottom: 6px; }
  input, select{
    width: 100%;
    padding: 10px 12px;
    margin: 0;
    border: 1px solid var(--line);
    border-radius: 14px;
    background: #fff;
    font-size: 13px;
    font-weight: 800;
    outline:none;
    box-shadow: 0 1px 0 rgba(0,0,0,.02);
  }
  input:focus, select:focus{
    border-color: rgba(37,99,235,.55);
    box-shadow: 0 0 0 4px rgba(37,99,235,.10);
  }

  .date-range-box{
    display:flex; gap:8px;
    background: linear-gradient(180deg, rgba(37,99,235,.05), rgba(37,99,235,.02));
    padding:10px; border-radius: 16px;
    border: 1px solid rgba(37,99,235,.18);
  }
  .date-range-box input{ border: 1px solid rgba(229,231,235,.9); border-radius: 14px; padding: 10px 10px; font-size:12px; }

  .profit-box{
    background: linear-gradient(135deg, rgba(22,163,74,1), rgba(34,197,94,1));
    color:#fff; padding:12px; border-radius: 18px;
    text-align:center; font-weight: 1000;
    box-shadow: var(--shadow2);
  }
  #displayTotalProfit{ font-size:16px; }

  .history-card{
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(229,231,235,.9);
    padding: 14px;
    border-radius: var(--r18);
    box-shadow: var(--shadow);
    margin-top: 14px;
    overflow: hidden;
    width: 100%;
  }
  .history-card h3{ margin:0 0 10px 0; font-size:15px; font-weight:1000; color:#0f172a; }

  .table-container{
    width: 100%;
    overflow-x: auto;
    margin-top: 10px;
    background: #fff;
    border-radius: 16px;
    border: 1px solid rgba(229,231,235,.9);
  }
  table{
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 14px;
    white-space: nowrap;
  }
  table th, table td{
    border-bottom: 1px solid rgba(229,231,235,.8);
    padding: 12px 10px;
    text-align: center;
    font-weight: 1000;
  }
  table th{
    background: linear-gradient(180deg, #0f172a, #111827);
    color: white;
    position: sticky;
    top: 0;
    z-index: 1;
    font-size: 13px;
    font-weight: 1000;
    border-bottom: 1px solid rgba(0,0,0,.2);
  }
  tbody tr:hover{ background: rgba(37,99,235,.06); }

  .col-no{ background-color: #f1f5f9; font-weight: 1000; }
  .col-date{ background-color: #fff7ed; }
  .col-name{ background-color: #eff6ff; font-weight: 1000; }

  .col-outamt{ background-color:#ffffff; color:#0f172a; font-weight:1000; }
  .col-sellamt{ background-color:#ffffff; color:#d9480f; font-weight:1000; }
  .col-cash{ background-color: #f0fdf4; color: #166534; font-weight: 1000; }

  .action-btn{
    padding: 8px 10px; border: none; border-radius: 12px;
    cursor:pointer; color:#fff; margin:2px;
    font-weight: 1000; font-size: 12px;
    box-shadow: var(--shadow2);
    transition:.15s;
  }
  .action-btn:active{ transform: scale(.99); }
  .btn-edit-row{ background: linear-gradient(135deg, rgba(37,99,235,1), rgba(96,165,250,1)); }
  .btn-pay-row{ background: linear-gradient(135deg, rgba(124,58,237,1), rgba(168,85,247,1)); }
  .btn-del-row{ background: linear-gradient(135deg, rgba(239,68,68,1), rgba(244,63,94,1)); }

  .modal{
    display:none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,.60);
    z-index: 100;
    justify-content:center;
    align-items:center;
    padding: 16px;
  }
  .modal-content{
    background: rgba(255,255,255,.95);
    border: 1px solid rgba(229,231,235,.9);
    padding: 16px;
    border-radius: 18px;
    width: 98%;
    max-width: 1100px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 40px 120px rgba(0,0,0,.25);
  }
  .modal-content h3{ margin:0 0 10px 0; font-size:15px; font-weight:1000; color:#0f172a; }

  .form-box{
    background: linear-gradient(180deg, rgba(15,23,42,.03), rgba(15,23,42,.01));
    border: 1px solid rgba(229,231,235,.9);
    padding: 14px;
    border-radius: 16px;
    margin-bottom: 14px;
  }
  .form-title{
    font-size: 13px; font-weight:1000;
    color:#0f172a;
    margin-bottom: 10px;
    border-bottom: 1px solid rgba(229,231,235,.9);
    padding-bottom: 8px;
  }

  #mainPersonSelect option:nth-child(even){ background-color: #f2f2f2; }
  #mainPersonSelect option:nth-child(odd){ background-color: #ffffff; }

  .save-btn{
    background: linear-gradient(135deg, rgba(15,23,42,1), rgba(31,41,55,1));
    color: white;
    border:none;
    padding: 12px;
    width: 100%;
    border-radius: 16px;
    font-weight: 1000;
    cursor:pointer;
    margin-top: 16px;
    box-shadow: var(--shadow2);
  }
  .cancel-btn{
    background: linear-gradient(135deg, rgba(239,68,68,1), rgba(244,63,94,1));
    color: white;
    border:none;
    padding: 12px;
    width: 100%;
    border-radius: 16px;
    font-weight: 1000;
    cursor:pointer;
    margin-top: 10px;
    box-shadow: var(--shadow2);
  }
  .ok-btn{
    background: linear-gradient(135deg, rgba(245,158,11,1), rgba(251,191,36,1));
    color: #111827;
    border:none;
    padding: 12px;
    width: 100%;
    border-radius: 16px;
    font-weight: 1000;
    cursor:pointer;
    margin-top: 10px;
    box-shadow: var(--shadow2);
  }
  .close-link{
    display:block;
    text-align:center;
    margin-top: 12px;
    color: var(--muted);
    cursor:pointer;
    text-decoration: underline;
    font-size: 13px;
    font-weight: 800;
  }

  .pagination-bar{
    padding: 12px 10px;
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(229,231,235,.9);
    border-radius: 16px;
    margin-top: 10px;
    display:flex;
    align-items:center;
    gap: 10px;
    box-shadow: 0 2px 10px rgba(15,23,42,.06);
  }
  .pager{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .page-btn{
    border: 1px solid rgba(229,231,235,.9);
    background: linear-gradient(180deg, rgba(15,23,42,.04), rgba(15,23,42,.02));
    color: #0f172a;
    padding: 8px 12px;
    border-radius: 14px;
    cursor:pointer;
    font-weight: 1000;
    min-width: 42px;
    text-align:center;
    transition:.15s;
    user-select:none;
  }
  .page-btn:hover{ transform: translateY(-1px); }
  .page-btn.active{
    background: linear-gradient(135deg, rgba(37,99,235,1), rgba(96,165,250,1));
    border-color: rgba(37,99,235,.6);
    color:#fff;
  }
  .page-btn.disabled{ opacity:.5; cursor:not-allowed; transform:none; }
  .page-ellipsis{ padding: 8px 6px; color: var(--muted); font-weight: 1000; }
  .page-size{ margin-left:auto; display:flex; align-items:center; gap: 8px; }
  .page-size select{
    padding: 8px 10px;
    border: 1px solid rgba(229,231,235,.9);
    border-radius: 14px;
    font-size: 13px;
    background: #fff;
    font-weight: 900;
    width: 90px;
  }

  .due-item{
    background:#fff;
    padding:10px 10px;
    border:1px solid rgba(229,231,235,.9);
    margin-top:8px;
    display:flex;
    justify-content:space-between;
    cursor:pointer;
    border-radius: 14px;
    font-weight: 900;
    color:#0f172a;
    box-shadow: 0 2px 10px rgba(15,23,42,.04);
  }
  .due-item:hover{ background: rgba(37,99,235,.04); }

  @media (max-width:520px){
    .nav-buttons .btn{ flex:1; justify-content:center; }
    .navbar{ padding: 10px 12px; }
    .main-container{ padding: 10px 10px; }
    .form-box{ padding: 10px; }
  }
</style>
</head>

<body>

<div id="pageLoader" class="page-loader">
  <div class="loader-card">
    <div class="spinner"></div>
    <div class="loader-title">‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    <p class="loader-sub">‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
  </div>
</div>

<div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebarFromOverlay()"></div>

<div class="navbar">
  <div class="nav-top">
    <span class="menu-icon" onclick="toggleSidebar(event)">‚ò∞</span>
    <h1>Buy & Sell</h1>
    <div style="width:22px"></div>
  </div>
  <div class="nav-buttons">
    <button class="btn btn-person" onclick="openModal('personModal')"><i class="fas fa-user-plus"></i> Person</button>
    <button class="btn btn-person" onclick="openModal('personListModal')"><i class="fas fa-list"></i> List</button>
    <button class="btn btn-delivery" onclick="openModal('deliverySelectModal')">üöö Delivery</button>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sb-head">
    <div>
      <div class="sb-title">Today Hisab</div>
      <div class="sb-sub">‡¶Æ‡ßá‡¶®‡ßÅ</div>
    </div>
    <button class="sb-close" onclick="closeSidebarFromOverlay()" aria-label="Close">‚úï</button>
  </div>
  <div class="sb-divider"></div>

  <div class="sb-links">
    <a href="index.html"><span class="sb-ic">üè†</span> Dashboard</a>
    <a href="hisab.html"><span class="sb-ic">üßæ</span> ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</a>
    <a href="stock.html"><span class="sb-ic">üì¶</span> ‡¶Æ‡¶æ‡¶≤‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï</a>
    <a href="today.html"><span class="sb-ic">üìÖ</span> ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßá‡¶≤</a>
    <a href="baki.html"><span class="sb-ic">üßç</span> ‡¶¨‡¶æ‡¶ï‡ßÄ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</a>
  </div>
</div>

<div class="main-container">
  <div class="filter-wrapper">
    <div class="filter-grid">
      <div>
        <label><i class="fas fa-calendar-alt"></i> ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ (‡¶∂‡ßÅ‡¶∞‡ßÅ - ‡¶∂‡ßá‡¶∑):</label>
        <div class="date-range-box">
          <input type="date" id="filterStartDate" onchange="applyFilters()">
          <input type="date" id="filterEndDate" onchange="applyFilters()">
        </div>
      </div>
      <div>
        <label><i class="fas fa-user"></i> ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
        <select id="filterPerson" onchange="applyFilters()"></select>
      </div>
      <div class="profit-box">
        <div style="font-size: 12px; opacity: 0.9;">‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶≠</div>
        <span id="displayTotalProfit">‡ß≥0</span>
      </div>
    </div>
  </div>

  <div class="history-card">
    <h3>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
            <th>‡¶®‡¶æ‡¶Æ</th>
            <th>‡¶¨‡¶π‡¶ø‡¶∞ ‡¶™‡¶£‡ßç‡¶Ø (‡¶ü‡¶æ‡¶ï‡¶æ)</th>
            <th>‡¶∏‡ßá‡¶≤ ‡¶™‡¶£‡ßç‡¶Ø (‡¶ü‡¶æ‡¶ï‡¶æ)</th>
            <th>‡¶ú‡¶Æ‡¶æ (‡¶ü‡¶æ‡¶ï‡¶æ)</th>
            <th>‡¶è‡¶ï‡¶∂‡¶®</th>
          </tr>
        </thead>
        <tbody id="historyTableBody"></tbody>
      </table>
    </div>

    <div class="pagination-bar">
      <div class="pager" id="pager"></div>
      <div class="page-size">
        <select id="pageSizeSelect" onchange="changePageSize()">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Delivery Select Modal (‡¶•‡¶æ‡¶ï‡¶¨‡ßá) -->
<div id="deliverySelectModal" class="modal">
  <div class="modal-content" style="max-width: 400px;">
    <h3>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡¶§‡¶æ</h3>
    <select id="mainPersonSelect"></select>
    <button class="save-btn" onclick="startDelivery()">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ</button>
    <button class="cancel-btn" onclick="closeModal('deliverySelectModal')">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>
</div>

<!-- ‡¶Ü‡¶ó‡ßá‡¶∞ deliveryMainModal ‡¶∞‡ßá‡¶ñ‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ (‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ) -->
<div id="deliveryMainModal" class="modal">
  <div class="modal-content">
    <h3>‡¶è‡¶á ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶Ü‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ</h3>
    <span class="close-link" onclick="closeModal('deliveryMainModal')">‡¶¨‡¶®‡ßç‡¶ß</span>
  </div>
</div>

<div id="paymentModal" class="modal">
  <div class="modal-content" style="max-width: 450px;">
    <h3 id="paymentTitle">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
    <div class="form-box">
      <label>‡¶®‡¶ó‡¶¶ ‡¶ú‡¶Æ‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ:</label>
      <input class="qty-inp" type="number" id="cashReceivedInput" value="0">
    </div>

    <div class="form-box" style="background: rgba(245,158,11,.08); border-color: rgba(245,158,11,.25);">
      <div class="form-title">‡¶¨‡¶æ‡¶ï‡ßÄ (‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï)</div>
      <input type="text" id="dueShopName" placeholder="‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
      <input class="qty-inp" type="number" id="dueAmount" value="0">
      <button class="ok-btn" style="background: linear-gradient(135deg, rgba(15,23,42,1), rgba(31,41,55,1)); color:#fff;" onclick="addDueToList()">‡¶¨‡¶æ‡¶ï‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <div id="dueListContainer"></div>
    </div>

    <button class="save-btn" onclick="savePaymentData()">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <span class="close-link" onclick="closeModal('paymentModal')">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</span>
  </div>
</div>

<div id="personModal" class="modal">
  <div class="modal-content" style="max-width: 520px;">
    <h3 id="personModalTitle">‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï</h3>
    <input type="hidden" id="personEditKey" value="">
    <input type="hidden" id="personOldName" value="">
    <input type="text" id="personName" placeholder="‡¶®‡¶æ‡¶Æ">
    <button class="save-btn" onclick="savePerson()">Save</button>
    <span class="close-link" onclick="closeModal('personModal')">‡¶¨‡¶®‡ßç‡¶ß</span>
  </div>
</div>

<div id="personListModal" class="modal">
  <div class="modal-content" style="max-width: 620px;">
    <h3>Person List</h3>

    <div class="form-box" style="margin-bottom:10px;">
      <div class="form-title">‡¶è‡¶° ‡¶ï‡¶∞‡¶æ ‡¶™‡¶æ‡¶∞‡¶∏‡ßã‡¶®</div>
      <div id="personListContainer"></div>
    </div>

    <div class="form-box" style="margin-bottom:0; background: rgba(37,99,235,.04); border-color: rgba(37,99,235,.18);">
      <div class="form-title">Hide ‡¶ï‡¶∞‡¶æ ‡¶™‡¶æ‡¶∞‡¶∏‡ßã‡¶® (Restore)</div>
      <div id="hiddenPersonListContainer"></div>
    </div>

    <span class="close-link" onclick="closeModal('personListModal')">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</span>
  </div>
</div>

<script type="module">
  import { database } from './firebase-config.js';
  import { ref, push, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  let packages = {};
  let currentDues = [];
  let selectedPersonName = "";
  let activePaymentGroupKey = null;
  let allTransactions = [];

  let currentCashData = 0;
  let currentDuesData = [];
  let currentEditingGroupKey = null;

  let currentPage = 1;
  let pageSize = 10;
  let lastSortedKeys = [];

  let editingDueIndex = null;

  let personsCache = []; // [{key, name}]

  const formatDate = (dateStr) => {
    if(!dateStr) return "";
    const [y, m, d] = dateStr.split('-');
    return `${d}-${m}-${y}`;
  };

  const todayISO = () => {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${da}`;
  };

  /* =========================
     ‚úÖ Loading control
     ========================= */
  const loaderEl = document.getElementById('pageLoader');
  const hideLoader = () => {
    if (!loaderEl) return;
    loaderEl.classList.add('hide');
    setTimeout(() => { loaderEl.style.display = 'none'; }, 260);
  };

  const loadState = { persons:false, categories:false, packages:false, transactions:false };
  const checkAllLoaded = () => {
    if (loadState.persons && loadState.categories && loadState.packages && loadState.transactions) hideLoader();
  };

  // ‚úÖ Sidebar UI
  window.toggleSidebar = (e) => {
    e.stopPropagation();
    const sb = document.getElementById('sidebar');
    sb.classList.toggle('open');
    const ov = document.getElementById('sidebarOverlay');
    if (sb.classList.contains('open')) ov.classList.add('show');
    else ov.classList.remove('show');
  };
  window.closeSidebarFromOverlay = () => {
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('sidebarOverlay').classList.remove('show');
  };
  document.addEventListener('click', (event) => {
    const sb = document.getElementById('sidebar');
    const menuIcon = document.querySelector('.menu-icon');
    if (!sb.contains(event.target) && event.target !== menuIcon) {
      sb.classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('show');
    }
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') window.closeSidebarFromOverlay(); });

  window.openModal = (id) => {
    document.getElementById(id).style.display = 'flex';
    if (id === "personListModal") renderPersonListModal();
  };
  window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; };

  /* =========================
     ‚úÖ Person Hide (only website) - LocalStorage
     ========================= */
  const LS_HIDDEN_PERSONS = "hisab_hidden_person_keys_v1";
  function getHiddenPersonKeys(){
    try{
      const raw = localStorage.getItem(LS_HIDDEN_PERSONS);
      const arr = JSON.parse(raw || "[]");
      return Array.isArray(arr) ? arr : [];
    }catch(e){
      return [];
    }
  }
  function setHiddenPersonKeys(arr){
    try{ localStorage.setItem(LS_HIDDEN_PERSONS, JSON.stringify(arr || [])); }catch(e){}
  }
  function isPersonHidden(key){
    return getHiddenPersonKeys().includes(key);
  }
  function hidePersonKey(key){
    const arr = getHiddenPersonKeys();
    if (!arr.includes(key)) arr.push(key);
    setHiddenPersonKeys(arr);
  }
  function restorePersonKey(key){
    const arr = getHiddenPersonKeys().filter(k => k !== key);
    setHiddenPersonKeys(arr);
  }

  function buildPersonOptions(){
    const visible = personsCache.filter(p => p && p.key && !isPersonHidden(p.key));

    let optionsMain = '<option value="">‡¶®‡¶æ‡¶Æ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®</option>';
    visible.forEach(p => { optionsMain += `<option value="${p.name}">${p.name}</option>`; });

    document.getElementById('mainPersonSelect').innerHTML = optionsMain;
    document.getElementById('filterPerson').innerHTML = '<option value="">‡¶∏‡¶ï‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø</option>' + optionsMain;

    renderPersonListModal();
  }

  function renderPersonListModal(){
    const cont = document.getElementById('personListContainer');
    const hcont = document.getElementById('hiddenPersonListContainer');
    if (!cont || !hcont) return;

    const hiddenKeys = getHiddenPersonKeys();
    const visible = personsCache.filter(p => p && p.key && !hiddenKeys.includes(p.key));
    const hidden = personsCache.filter(p => p && p.key && hiddenKeys.includes(p.key));

    const rowHtml = (p, hiddenMode=false) => `
      <div class="due-item" style="cursor: default;">
        <span style="font-weight:1000;">${p.name}</span>
        <span style="display:flex; gap:8px; align-items:center;">
          ${
            hiddenMode
              ? `<button class="action-btn btn-edit-row" style="padding:8px 10px;" onclick="restorePerson('${p.key}')"><i class="fas fa-rotate-left"></i> Restore</button>`
              : `
                <button class="action-btn btn-edit-row" style="padding:8px 10px;" onclick="openPersonEdit('${p.key}')"><i class="fas fa-pen"></i> Edit</button>
                <button class="action-btn btn-del-row" style="padding:8px 10px;" onclick="hidePerson('${p.key}')"><i class="fas fa-eye-slash"></i> Hide</button>
              `
          }
        </span>
      </div>
    `;

    cont.innerHTML = visible.length ? visible.map(p => rowHtml(p,false)).join("") : `<div style="text-align:center; color: var(--muted); font-weight:900; padding: 10px 0;">‡¶ï‡ßã‡¶®‡ßã Person ‡¶®‡ßá‡¶á</div>`;
    hcont.innerHTML = hidden.length ? hidden.map(p => rowHtml(p,true)).join("") : `<div style="text-align:center; color: var(--muted); font-weight:900; padding: 10px 0;">‡¶ï‡ßá‡¶â Hide ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á</div>`;
  }

  window.hidePerson = (key) => {
    const p = personsCache.find(x => x.key === key);
    if (!p) return;
    if(!confirm(`"${p.name}" Hide ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? (‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶á‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶¨‡ßá ‡¶®‡¶æ)`)) return;
    hidePersonKey(key);
    buildPersonOptions();
  };

  window.restorePerson = (key) => {
    restorePersonKey(key);
    buildPersonOptions();
  };

  window.openPersonEdit = (key) => {
    const p = personsCache.find(x => x.key === key);
    if (!p) return;

    document.getElementById('personModalTitle').innerText = "Person Edit";
    document.getElementById('personEditKey').value = p.key;
    document.getElementById('personOldName').value = p.name || "";
    document.getElementById('personName').value = p.name || "";

    closeModal('personListModal');
    openModal('personModal');
  };

  // ‚úÖ Persons
  let personsFirstLoad = true;
  onValue(ref(database, 'persons'), (snapshot) => {
    personsCache = [];
    snapshot.forEach(child => {
      personsCache.push({ key: child.key, name: child.val()?.name || "" });
    });
    personsCache.sort((a,b) => (a.name || "").localeCompare(b.name || ""));
    buildPersonOptions();

    if (personsFirstLoad) {
      personsFirstLoad = false;
      loadState.persons = true;
      checkAllLoaded();
    }
  });

  // ‚úÖ Categories (loader only)
  let categoriesFirstLoad = true;
  onValue(ref(database, 'categories'), () => {
    if (categoriesFirstLoad) {
      categoriesFirstLoad = false;
      loadState.categories = true;
      checkAllLoaded();
    }
  });

  // ‚úÖ Packages
  let packagesFirstLoad = true;
  onValue(ref(database, 'packages'), (snapshot) => {
    packages = {};
    snapshot.forEach(child => { packages[child.key] = { ...child.val(), key: child.key }; });

    if (packagesFirstLoad) {
      packagesFirstLoad = false;
      loadState.packages = true;
      checkAllLoaded();
    }
  });

  // ‚úÖ Transactions
  let transactionsFirstLoad = true;
  onValue(ref(database, 'transactions'), (snapshot) => {
    allTransactions = [];
    snapshot.forEach(child => { allTransactions.push({key: child.key, ...child.val()}); });
    applyFilters();

    if (transactionsFirstLoad) {
      transactionsFirstLoad = false;
      loadState.transactions = true;
      checkAllLoaded();
    }
  });

  /* =========================================================
     ‚úÖ NEW: Delivery opens in new window (full page)
     ========================================================= */
  function makeNewGroupId(person, date){
    return `g_${date}_${person}_${Date.now()}_${Math.random().toString(16).slice(2)}`;
  }

  function openDeliveryWindow({ personName, date, groupId }){
    const q = new URLSearchParams();
    q.set("person", personName || "");
    q.set("date", date || "");
    q.set("groupId", groupId || "");
    const url = `delivery-form.html?${q.toString()}`;
    window.location.href = url;
  }

  // ‚úÖ Delivery start after person select
  window.startDelivery = () => {
    const s = document.getElementById('mainPersonSelect');
    if(!s.value) return alert("‡¶≤‡ßã‡¶ï ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®");
    const person = s.value;
    const date = todayISO();
    const gid = makeNewGroupId(person, date);

    closeModal('deliverySelectModal');
    openDeliveryWindow({ personName: person, date, groupId: gid });
  };

  // ‚úÖ Report rule (FIXED) - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞‡¶á ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã
  window.applyFilters = () => {
    currentPage = 1;

    const startDate = document.getElementById('filterStartDate').value;
    const endDate = document.getElementById('filterEndDate').value;
    const filterPerson = document.getElementById('filterPerson').value;

    const filtered = allTransactions.filter(t => {
      const dateMatch = (!startDate || t.date >= startDate) && (!endDate || t.date <= endDate);
      const personMatch = !filterPerson || t.personName === filterPerson;
      return dateMatch && personMatch;
    });

    const grouped = {};
    let totalProfit = 0;
    const hasFilter = startDate || endDate || filterPerson;

    filtered.forEach(t => {
      const gId = (t.groupId || "").trim() || `${t.date}_${t.personName}__legacy`;
      const groupKey = gId;

      if(!grouped[groupKey]) grouped[groupKey] = {
        groupId: gId,
        date: t.date,
        name: t.personName,

        outPcs: 0,
        returnPcs: 0,

        outAmt: 0,
        returnAmt: 0,
        sellAmt: 0,

        cash: 0,
        items: [],
        lastKey: t.key || "",

        saleConfirmed: false
      };

      if ((t.key || "") > (grouped[groupKey].lastKey || "")) grouped[groupKey].lastKey = t.key || "";

      const type = t.type || "Out";
      const sellPrice = parseFloat(t.pkgSellPrice) || 0;
      const totalPcs = parseInt(t.totalPcs) || 0;

      if (t.saleConfirmed === true) grouped[groupKey].saleConfirmed = true;

      if(hasFilter) {
        const pkgInfo = Object.values(packages).find(p => p.name === t.pkgName);
        if(pkgInfo) {
          const buyPrice = parseFloat(pkgInfo.buyPrice) || 0;
          const unitProfit = sellPrice - buyPrice;
          if(type === "Out") totalProfit += (unitProfit * totalPcs);
          else totalProfit -= (unitProfit * totalPcs);
        }
      }

      const amt = totalPcs * sellPrice;

      if(type === "Out"){
        grouped[groupKey].outPcs += totalPcs;
        grouped[groupKey].outAmt += amt;
      }else{
        grouped[groupKey].returnPcs += totalPcs;
        grouped[groupKey].returnAmt += amt;
      }

      grouped[groupKey].cash = (parseFloat(t.cashReceived) || 0);
      grouped[groupKey].items.push(t);
    });

    Object.keys(grouped).forEach(k => {
      const g = grouped[k];
      g.sellAmt = (g.outAmt || 0) - (g.returnAmt || 0);
      g.displaySellAmt = ((g.returnPcs || 0) > 0 || g.saleConfirmed === true) ? g.sellAmt : 0;
    });

    document.getElementById('displayTotalProfit').innerText = hasFilter ? `‡ß≥${totalProfit.toFixed(2)}` : `‡ß≥0`;
    renderTable(grouped);
  };

  function renderTable(grouped) {
    const tbody = document.getElementById('historyTableBody');
    tbody.innerHTML = "";

    const sortedKeys = Object.keys(grouped).sort((a, b) => {
      const A = grouped[a], B = grouped[b];
      if (A.date !== B.date) return (B.date || "").localeCompare(A.date || "");
      return (B.lastKey || "").localeCompare(A.lastKey || "");
    });

    lastSortedKeys = sortedKeys;

    const total = sortedKeys.length;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));
    if (currentPage > totalPages) currentPage = totalPages;

    const startIdx = (currentPage - 1) * pageSize;
    const endIdx = startIdx + pageSize;
    const pageKeys = sortedKeys.slice(startIdx, endIdx);

    let count = startIdx + 1;

    pageKeys.forEach(groupKey => {
      const row = grouped[groupKey];
      tbody.innerHTML += `<tr>
        <td class="col-no">${count++}</td>
        <td class="col-date">${formatDate(row.date)}</td>
        <td class="col-name">${row.name}</td>

        <td class="col-outamt">‡ß≥${(row.outAmt || 0).toFixed(2)}</td>
        <td class="col-sellamt">‡ß≥${(row.displaySellAmt || 0).toFixed(2)}</td>
        <td class="col-cash">‡ß≥${(row.cash || 0).toFixed(2)}</td>

        <td>
          <!-- ‚úÖ Changed: form opens new page -->
          <button class="action-btn btn-edit-row" onclick="openDeliveryFormPage('${row.groupId}', '${row.name}', '${row.date}')"><i class="fas fa-file-invoice"></i> Form</button>
          <button class="action-btn btn-pay-row" onclick="openPaymentForm('${groupKey}')"><i class="fas fa-money-bill-wave"></i> ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
          <button class="action-btn btn-del-row" onclick="deleteTransactionGroup('${groupKey}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>`;
    });

    window.groupedData = grouped;
    renderPager(totalPages);
  }

  // ‚úÖ NEW: open existing group in full page
  window.openDeliveryFormPage = (groupId, name, date) => {
    openDeliveryWindow({ personName: name, date, groupId });
  };

  window.changePageSize = () => {
    pageSize = parseInt(document.getElementById('pageSizeSelect').value, 10) || 10;
    currentPage = 1;
    if (window.groupedData) renderTable(window.groupedData);
  };

  window.gotoPage = (p) => {
    const total = lastSortedKeys.length;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));
    if (p < 1 || p > totalPages) return;
    currentPage = p;
    if (window.groupedData) renderTable(window.groupedData);
  };

  function makeBtn(text, onClick, disabled) {
    const btn = document.createElement('div');
    btn.className = "page-btn" + (disabled ? " disabled" : "");
    btn.textContent = text;
    if (!disabled) btn.onclick = onClick;
    return btn;
  }

  function makePageBtn(pageNum) {
    const btn = document.createElement('div');
    btn.className = "page-btn" + (pageNum === currentPage ? " active" : "");
    btn.textContent = String(pageNum);
    btn.onclick = () => gotoPage(pageNum);
    return btn;
  }

  function renderPager(totalPages) {
    const pager = document.getElementById('pager');
    pager.innerHTML = "";
    pager.appendChild(makeBtn("<<", () => gotoPage(currentPage - 1), currentPage === 1));

    const maxShow = 5;
    const showUntil = Math.min(maxShow, totalPages);
    for (let p = 1; p <= showUntil; p++) pager.appendChild(makePageBtn(p));

    if (totalPages > maxShow + 1) {
      const ell = document.createElement('span');
      ell.className = "page-ellipsis";
      ell.textContent = "...";
      pager.appendChild(ell);
      pager.appendChild(makePageBtn(totalPages));
    } else if (totalPages === maxShow + 1) {
      pager.appendChild(makePageBtn(totalPages));
    }

    pager.appendChild(makeBtn(">>", () => gotoPage(currentPage + 1), currentPage === totalPages));
  }

  /* =========================
     ‚úÖ Payment, Delete, Person Edit
     ========================= */
  window.openPaymentForm = (groupKey) => {
    activePaymentGroupKey = groupKey;
    const group = window.groupedData[groupKey];
    document.getElementById('paymentTitle').innerText = group.name + " - ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶®";
    document.getElementById('cashReceivedInput').value = String(group.cash || 0);
    currentDues = group.items[0]?.dues || [];
    editingDueIndex = null;
    renderDuesList();
    openModal('paymentModal');
  };

  window.addDueToList = () => {
    const shop = document.getElementById('dueShopName').value.trim();
    const amt = parseFloat(document.getElementById('dueAmount').value) || 0;
    if(!shop || amt <= 0) return;

    if (editingDueIndex !== null && currentDues[editingDueIndex]) {
      currentDues[editingDueIndex] = { shop, amt };
      editingDueIndex = null;
    } else {
      currentDues.push({ shop, amt });
    }

    document.getElementById('dueShopName').value = "";
    document.getElementById('dueAmount').value = "0";
    renderDuesList();
  };

  window.editDueItem = (idx) => {
    if (!currentDues[idx]) return;
    editingDueIndex = idx;
    document.getElementById('dueShopName').value = currentDues[idx].shop || "";
    document.getElementById('dueAmount').value = String(currentDues[idx].amt || 0);
  };

  function renderDuesList() {
    const cont = document.getElementById('dueListContainer');
    cont.innerHTML = "";
    currentDues.forEach((d, i) => {
      cont.innerHTML += `
        <div class="due-item" onclick="editDueItem(${i})">
          <span>${d.shop}</span>
          <span>‡ß≥${d.amt}</span>
        </div>
      `;
    });
  }

  window.savePaymentData = async () => {
    const cash = parseFloat(document.getElementById('cashReceivedInput').value) || 0;
    const items = window.groupedData[activePaymentGroupKey].items;
    for(let item of items) {
      await update(ref(database, `transactions/${item.key}`), { cashReceived: cash, dues: currentDues });
    }
    alert("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    closeModal('paymentModal');
    applyFilters();
  };

  function getPkgKeyByName(name) {
    const k = Object.keys(packages).find(x => (packages[x]?.name || "") === name);
    return k || null;
  }

  window.deleteTransactionGroup = async (groupKey) => {
    if(!confirm("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
    const items = window.groupedData[groupKey].items;

    for(let itm of items) {
      const pKey = getPkgKeyByName(itm.pkgName);
      if(pKey) {
        const pkg = packages[pKey];

        let adj = 0;
        if ((itm.type || "Out") === "Out") {
          const applied = parseInt(itm.appliedSellPcs || 0) || 0;
          const legacy = parseInt(itm.totalPcs || 0) || 0;
          adj = (applied > 0) ? applied : legacy;
        } else {
          adj = 0;
        }

        if (adj !== 0) {
          await update(ref(database, `packages/${pKey}`), { stock: (parseInt(pkg.stock) || 0) + adj });
          packages[pKey].stock = (parseInt(pkg.stock) || 0) + adj;
        }
      }

      await remove(ref(database, `transactions/${itm.key}`));
    }

    alert("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    applyFilters();
  };

  // ‚úÖ Rename person everywhere (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã)
  async function renamePersonEverywhere(oldName, newName){
    if (!oldName || !newName || oldName === newName) return;

    const snap = await get(ref(database, 'transactions'));
    if (!snap.exists()) return;

    const updates = [];
    snap.forEach(ch => {
      const v = ch.val() || {};
      if ((v.personName || "") === oldName) {
        updates.push(update(ref(database, `transactions/${ch.key}`), { personName: newName }));
      }
    });

    if (updates.length) await Promise.all(updates);
  }

  window.savePerson = async () => {
    const name = document.getElementById('personName').value.trim();
    if(!name) return;

    const editKey = (document.getElementById('personEditKey').value || "").trim();
    const oldName = (document.getElementById('personOldName').value || "").trim();

    if(!editKey){
      push(ref(database, 'persons'), { name }).then(() => {
        document.getElementById('personName').value = "";
        closeModal('personModal');
      });
      return;
    }

    try{
      await update(ref(database, `persons/${editKey}`), { name });
      await renamePersonEverywhere(oldName, name);

      document.getElementById('personEditKey').value = "";
      document.getElementById('personOldName').value = "";
      document.getElementById('personName').value = "";
      document.getElementById('personModalTitle').innerText = "‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï";

      alert("‚úÖ Person ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
      closeModal('personModal');
      renderPersonListModal();
    }catch(e){
      alert(e.message);
    }
  };

</script>
</body>
</html>
